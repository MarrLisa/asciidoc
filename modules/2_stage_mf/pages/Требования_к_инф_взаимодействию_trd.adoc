include::common/contract.adoc[]
:docinfo: shared
:!chapter-signifier:
:!section-refsig:
:figure-caption!:
:imagesdir: ../images
:table-caption!: 
:section-refsig: разделе
:toc: macro
:toc-title: Содержание 
:name1_dokument: Требования к информационному взаимодействию с внешними информационными системами
:name5_dokument: 
:sectnumlevels: 7
// Кол-во страниц соответствует пдф и версия
:version: 1
:page_all: 22
:code: ТЗ.02
:toclevels: 4
:ramka: 1
:plan:
// :title-page: — это директива, которая создает отдельную страницу титульного листа для документа.

//Служеб. настрока титульника. Менять год здесь
include::tables/titul_doc.adoc[]

<<<<
toc::[]

<<<<
:!sectnums: 
== Перечень терминов и сокращений
[cols="2*", options="header"]
|===
^| Термин/сокращение             ^| Определение/расшифровка
| Веб-сервис                    | Идентифицируемая веб-адресом программная система со стандартизированными интерфейсами
| Информационное взаимодействие | Совместное использование данных, находящихся в общей информационной системе, и обмен данными, осуществляемые субъектами (2 и более) деятельности в соответствии с принятыми правилами информационного обмена
| ИС                            | Информационная система
| Модуль                        | Модуль организации предоставления в электронном виде мер государственной финансовой поддержки юридическим лицам, индивидуальным предпринимателям, а также физическим лицам – производителям товаров, работ, услуг управления расходами государственной интегрированной информационной системы управления общественными финансами «Электронный бюджет»
| Сообщение                     | Сведения в виде законченного блока данных, передаваемые при функционировании информационной системы
| ФСТЭК России                  | Федеральная служба по техническому и экспортному контролю
| Электронная подпись           | Простая электронная подпись (Федеральный закон от 06.04.2011 N 63-ФЗ «Об электронной подписи»)
| FTP                           | File Transfer Protocol – протокол передачи файлов
| SOAP                          | Протокол обмена структурированными сообщениями в распределённой вычислительной среде
| UTF-8                         | Одна из общепринятых и стандартизированных кодировок текста, которая позволяет хранить символы Юникода, используя переменное количество байт (от 1 до 6)
| XML                           | eXtensible Markup Language — это универсальный, не зависящий от платформы язык разметки
| XSD                           | Язык описания структуры XML документа (или XML Schema). При использовании XSD существует возможность проверки не только правильности синтаксиса XML документа, но также его структуры, модели содержания и типов данных
|===


// Основная часть ********************
:sectnums: 
[%breakable]
== Цели информационного взаимодействия с внешними информационными системами

В Модуле должно быть обеспечено информационное взаимодействие с внешними информационными системами для выполнения следующих задач:

* формирование профиля получателя субсидии;
* передача информации о субсидиях, предоставляемых из федерального, регионального и муниципального бюджетов;
* получение информации об отборах получателей субсидий, предоставляемых из федерального, регионального и муниципального бюджетов;
* получение информации о ходе проведения в рамках иной информационной системы отборов получателей субсидий, предоставляемых из федерального бюджета;
* получение информации о результатах проведения в рамках иной информационной системы отборов получателей субсидий (грантов в форме субсидий), предоставляемых из федерального бюджета;
* получение данных по проверкам получателя субсидии;
* передача информации об отборах, а также о ходе и результатах их проведения, полученной из иных информационных систем, подсистемам (компонентам, модулям), оператором которых является Федеральное казначейство.

[%breakable]
== Технические принципы информационного взаимодействия и обмена информационными ресурсами 

:num_i: {counter:figure-number}
Информационное обеспечение Модуля осуществляется микросервисной архитектурой, использующей базы данных, интеграцию с подсистемами компонентами модулями государственной интегрированной информационной системы управления общественными финансами «Электронный бюджет» (далее – система «Электронный бюджет») и информационное взаимодействие с другими ГИС. Схема информационного взаимодействия Модуля приведена на <<id_i_{num_i}, Рисунке {num_i}>>.

[%breakable]
[#id_i_{num_i}]
.Рисунок {num_i}. Схема информационного взаимодействия Модуля
image::i_external_system.png[]

Взаимодействие Модуля с внешними ИС должен осуществляться посредством:

* системы межведомственного электронного взаимодействия (СМЭВ);
* интерфейс прикладного программирования (ФНС);
* парсинга сайтов (РАФП, Рособрнадзор, ФССП);
* файловый обмен (FTP).

СМЭВ позволяет федеральным, региональным и местным органам власти, кредитным организациям (банкам), внебюджетным фондам, и прочим участникам СМЭВ обмениваться данными, необходимыми для оказания государственных услуг гражданам и организациям, в электронном виде.

Интерфейс прикладного программирования (API – application programming interface), набор методов, классов, библиотек, функций, обеспечивающих взаимодействие программ между собой и представляет собой промежуточный слой между двумя приложениями.

Парсинг сайтов – это автоматизированный сбор неструктурированной информации на различных сайтах, ее преобразование и передача в структурированном виде.

[%breakable]
== Требования к нормативно-справочной информации, передаваемой при информационном обмене

Модуль должен использовать необходимую нормативно-справочную информацию, которая ведется и хранится Подсистемой управления расходами «Электронный бюджет». Обновление записей централизованных справочников должно обеспечиваться администратором Модуля в случае актуализации используемой Модулем нормативно-справочной информации в Подсистеме управления расходами «Электронный бюджет». 

При обновлении централизованной нормативно-справочной информации должны передаваться данные о новых записях в справочниках за период, об аннулированных записях в справочниках за период, об измененных записях в справочниках за период.

[%breakable]
=== Перечень нормативно-справочной информации, используемой в информационном обмене

:num_t: {counter:table-number}
Перечень справочников и классификаторов, используемых Модулем в информационном обмене, приведен в <<id_t_{num_t}, Таблице {num_t}>>.

[%breakable]
[#id_t_{num_t}]
.Таблица {num_t}. Перечень справочников, используемых в информационном обмене
[cols="1,6,5", options="header"]
|===
^| № +
п/п ^| Наименование справочника ^| Таблица                                         
^| {counter:t_row}.  | Категория Получателей субсидии                   | TagActivityRecipientCategory
^| {counter:t_row}.  | Тип субсидии                                     | TagSubsidyType              
^| {counter:t_row}.  | Способ проведения отбора                         | TagRecipientSelectionWay    
^| {counter:t_row}.  | Организация, предоставляющая субсидию            | TagActivityPpp              
^| {counter:t_row}.  | Направления ОКВЭД (субсидия и субсидийный отбор) | TagActivitySectionOkved     
^| {counter:t_row}.  | ОКВЭД (субсидия и субсидийный отбор)             | TagActivityOkved            
^| {counter:t_row}.  | Место проведения отбора (субсидийного)           | FiasAddress                 
^| {counter:t_row}.  | Направления ОКВЭД (отборы по услугам)            | TagSoServiceOkvedDirection  
^| {counter:t_row}.  | ОКВЭД (отборы по услугам)                        | TagSoServiceOkved           
^| {counter:t_row}.  | ОКТМО (отборы по услугам)                        | TagSoServiceOktmo           
|===
:!t_row:

[%breakable]
== Требования к информационному взаимодействию с внешними информационными системами
=== Режимы взаимодействия 

Обмен данными между модулем и внешними информационными системами или подсистемами (модулями, компонентами) системы «Электронный бюджет» должен осуществляться в синхронном режиме по модели «Запрос – Ответ» с использованием механизма гарантированной доставки. Описание способов внешних и с подсистемами (модулями, компонентами) системы «Электронный бюджет» интеграционных взаимодействий указано в таблице (Таблица 2). 

[.landscape]
<<<<
Таблица 2. Интеграционные взаимодействия внешние и с подсистемами (модулями, компонентами) системы «Электронный бюджет» 

include::tables/t_integr_vzaim.adoc[]

[.portrait]
<<<<

[%breakable]
==== Система межведомственного электронного взаимодействия

Доступ к ГИС осуществляется по запросу в Федеральный ситуационный центр электронного правительства в соответствии с Правилами и процедурами работы в СМЭВ, опубликованными в открытом доступе на технологическом портале СМЭВ. Ссылка на систему: http://smev3.gosuslugi.ru/  - Технологический портал СМЭВ 3. 

[%breakable]
==== Интерфейс API
В модуле взаимодействие с другими ИС, посредством API, обеспечивается с помощью следующих сервисов:

* Профиль получателя (mrecepient-profile);
* Настройка конкурса, публичная часть (m-data);
* Настройка конкурса, заявки (application). 

[%breakable]
=== Механизмы обмена информационными ресурсами

==== Система межведомственного электронного взаимодействия

В процессе информационного взаимодействия ИС поставщика и потребителя обмениваются сообщениями. ИС, отправляющая сообщение через СМЭВ, является отправителем сообщения, а ИС, получающая сообщение из СМЭВ, – получателем. Упрощенно, процесс обмена сообщениями между ИС потребителя и ИС поставщика через СМЭВ включает последовательность следующих шагов:

* передача запроса от ИС потребителя в СМЭВ;
* размещение запроса в СМЭВ в очереди запросов поставщика;
* получение запроса ИС поставщика из СМЭВ;
* подготовка поставщиком ответа на запрос;
* передача подготовленного ответа из ИС поставщика в СМЭВ;
* размещение ответа в СМЭВ в очереди ответов потребителя;
* получение ответа ИС потребителя из СМЭВ.

:num_i: {counter:figure-number}
На <<id_i_{num_i}, Рисунке {num_i}>> изображена схема обмена сообщениями используя СМЭВ. 

[%breakable]
[#id_i_{num_i}]
.Рисунок {num_i}. Схема обмена сообщениями используя СМЭВ
image::schema_sms_smev.png[]

Взаимодействие в СМЭВ осуществляется в асинхронном режиме. Каждая из операций передачи/получения сообщения (с запросом или ответом) реализуется путем вызова соответствующего метода единого электронного сервиса СМЭВ. 
Сообщения, передаваемые в СМЭВ, типизируются на запрос и ответ. В СМЭВ все сообщения обрабатываются одинаковым образом.

Сообщение-запрос инициирует сеанс обмена сведениями между потребителем и поставщиком, а сообщение-ответ завершает указанный сеанс обмена. Для некоторых видов запросов ответ не требуется (Широковещательные рассылки). При этом для отражения прикладной специфики в ходе проектирования видов сведений могут быть использованы различные приемы организации сеансов обмена экземплярами видов сведений. Указанные приемы характеризуются различными целями инициатора обмена и включают в себя:

* стандартный сеанс обмена;
* инициативный сеанс обмена.

При организации стандартного сеанса обмена целью его инициатора является получение сведений от поставщика. В сообщении-запросе вида сведений, реализующего данный прием, как правило, содержатся критерии отбора экземпляров сведений, размещенных в информационной системе поставщика, а в сообщении-ответе содержатся запрашиваемые экземпляры.

При организации инициативного сеанса обмена целью его инициатора является получение от информационной системы поставщика подтверждения факта доставки ему некоторых сведений. В данном случае сообщение-запрос содержит весь массив передаваемых сведений, которые информационная система – инициатор сеанса обмена намерена передать. А сообщение-ответ, при этом, как правило, содержит сведения, описывающие факт получения сведений от инициатора.

Обмен сообщениями в СМЭВ осуществляется через механизм очередей. Все очереди сообщений являются входящими и закреплены за получателями сообщений. Все сообщения, которые отправляют информационные системы, попадают в очереди входящих сообщений, закреплённые за получателями (информационными системами). При этом очереди СМЭВ предназначены, прежде всего, для решения технологических задач: буферизация сообщений на время проведения предусмотренных СМЭВ проверок, а также вынужденных кратковременных прерываний в работе информационных систем, связанных с техническими работами. Очереди входящих сообщений делятся на очереди входящих запросов и очереди входящих ответов на запросы.

Электронные сообщения в системе межведомственного электронного взаимодействия передаются в формате XML в кодировке UTF-8 с указанием кодировки в заголовке сообщения. Соответствующие им WSDL и XSD файлы также должны использовать кодировку UTF-8 с указанием кодировки в заголовке сообщения. Общие требования и ограничения, связанные с использованием языка XML Schema, соблюдение которых обязательно при проектировании XSD-схем видов сведений, приведены в документе «Требования к XML-схемам, регистрируемым в СМЭВ», размещаемом на Технологическом портале СМЭВ3. 
Процесс отправки ИС потребителя запроса и получения ответа на запрос от ИС поставщика представляет собой̆ последовательность вызовов единого электронного сервиса СМЭВ информационными системами потребителя и поставщика: 

* передача в СМЭВ запроса из ИС потребителя (//SendRequestRequest); 
* получение из СМЭВ запроса в ИС поставщика (//GetRequestResponse); 
* подтверждение поставщиком получения запроса из СМЭВ (//AckRequest); 
* передача в СМЭВ ответа из ИС поставщика (//SendResponseRequest); 
* получение из СМЭВ ответа либо ответа со статусом в ИС потребителя (//GetResponseResponse) 
* подтверждение потребителем получения ответа из СМЭВ (//AckRequest). 

==== Интерфейс прикладного программирования

API – это механизмы, которые позволяют двум программным компонентам взаимодействовать друг с другом, используя набор определений и протоколов. Для информационного обмена должен использоваться SOAP API (SOAP – Simple Object Access Protocol), т. е. простой протокол доступа к объектам. Клиент и сервер обмениваются сообщениями посредством XML.

==== Парсинг сайтов

Процесс парсинга веб-сайтов состоит из следующих последовательных шагов:

* идентификация целевых URL-адресов;
* отправка запросов на эти URL -адреса для получения HTML-кода;
* использование указателей для обнаружения местонахождения данных в HTML -коде;
* аналитический разбор строки данных, которая содержит нужную информацию;
* преобразование собранных данных в желаемый формат;
* передача собранных данных в выбранное хранилище данных.

<<<<
:!sectnums: 
== Источники разработки
{counter:t_row}. Министерство цифрового развития, связи и массовых коммуникаций Российской Федерации. Единая система межведомственного электронного взаимодействия (СМЭВ). URL: https://digital.gov.ru/ru/activity/govservices/infosystems/22/?utm_referrer=https%3a%2f%2fyandex.ru%2f  

{counter:t_row}. Хабр. Протоколы SFTP и FTPS / Хабр. URL: https://habr.com/ru/post/500438/. 

// Основная часть ********************

[.portrait]
<<<<
include::tables/t_podpis.adoc[]

<<<<
include::tables/t_list_change.adoc[]
